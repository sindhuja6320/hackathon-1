<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innovation Tracking Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-lightbulb me-2"></i>Innovation Portal
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#recognition">Recognition</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#collaborate">Collaborate</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#analytics">Analytics</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#leaderboard">Leaderboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#nominations">Nominations</a>
                    </li>
                </ul>
                <!-- Profile Dropdown -->
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown">
                        <div class="profile-avatar me-2">
                            <i class="fas fa-user-circle fa-2x"></i>
                        </div>
                        <div class="profile-info text-light">
                            <span id="userName">Loading...</span>
                        </div>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end animate__animated animate__fadeIn">
                        <li class="dropdown-header">
                            <div class="d-flex flex-column">
                                <span id="userFullName" class="fw-bold">Loading...</span>
                                <span id="userEmail" class="text-muted small">Loading...</span>
                                <span id="userDepartment" class="text-muted small">Loading...</span>
                            </div>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#profileSettingsModal"><i class="fas fa-user-cog me-2"></i>Profile Settings</a></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-bell me-2"></i>Notifications</a></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="javascript:void(0)" onclick="window.logout()"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#achievementsModal">
                            <i class="fas fa-trophy me-2"></i>Achievements
                        </a></li>
                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#settingsModal">
                            <i class="fas fa-cog me-2"></i>Settings
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Profile Settings Modal -->
    <div class="modal fade" id="profileSettingsModal" tabindex="-1" aria-labelledby="profileSettingsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="profileSettingsModalLabel">Profile Settings</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="profileSettingsForm" class="needs-validation" novalidate>
                        <div class="text-center mb-4">
                            <div class="profile-image-container">
                                <div class="profile-image">
                                    <i class="fas fa-user-circle fa-4x"></i>
                                </div>
                                <button type="button" class="btn btn-sm btn-primary upload-btn">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="firstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="firstName" required>
                                <div class="invalid-feedback">Please enter your first name.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="lastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="lastName" required>
                                <div class="invalid-feedback">Please enter your last name.</div>
                            </div>
                            <div class="col-12">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="profileEmail" required>
                                <div class="invalid-feedback">Please enter a valid email address.</div>
                            </div>
                            <div class="col-12">
                                <label for="department" class="form-label">Department</label>
                                <select class="form-select" id="department" required>
                                    <option value="">Choose...</option>
                                    <option value="Engineering">Engineering</option>
                                    <option value="Marketing">Marketing</option>
                                    <option value="Sales">Sales</option>
                                    <option value="HR">Human Resources</option>
                                    <option value="Finance">Finance</option>
                                </select>
                                <div class="invalid-feedback">Please select your department.</div>
                            </div>
                            <div class="col-12">
                                <label for="bio" class="form-label">Bio</label>
                                <textarea class="form-control" id="bio" rows="3" placeholder="Tell us about yourself..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProfileSettings()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div class="modal fade" id="achievementsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Achievements & Badges</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="achievement-progress mb-4">
                        <h6>Progress</h6>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <small class="text-muted">Earned: <span id="earned-badges">0</span> / <span id="total-badges">0</span></small>
                    </div>
                    
                    <div class="row" id="achievements-list">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Notification Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="settingsForm">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                            <label class="form-check-label" for="emailNotifications">
                                Email Notifications
                            </label>
                            <small class="form-text text-muted d-block">
                                Receive email notifications for nominations and achievements
                            </small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSettings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <header class="hero-section">
        <div class="container text-center">
            <h1>Welcome to Innovation Tracking Portal</h1>
            <p>Discover, Share, and Celebrate Innovation Excellence</p>
        </div>
    </header>

    <!-- Dashboard Section -->
    <section id="dashboard" class="section">
        <div class="container">
            <h2>Innovation Dashboard</h2>
            <div class="dashboard-widgets" id="draggable-dashboard">
                <div class="row">
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="widget" draggable="true">
                            <h3>Innovation Metrics</h3>
                            <canvas id="innovationMetrics"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="widget" draggable="true">
                            <h3>Department Performance</h3>
                            <canvas id="departmentPerformance"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="widget" draggable="true">
                            <h3>Recent Activities</h3>
                            <div class="activity-feed" id="activityFeed"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Recognition Section -->
    <section id="recognition" class="recognition-section py-5">
        <div class="container">
            <div class="section-header text-center mb-5">
                <h2 class="display-4 fw-bold text-primary">Innovation Champions</h2>
                <p class="lead text-muted">Celebrating our top contributors who drive innovation forward</p>
            </div>

            <!-- Top Contributors Carousel -->
            <div class="top-contributors mb-5">
                <div class="row">
                    <div class="col-12">
                        <div class="owl-carousel contributor-carousel">
                            <!-- Top Contributors will be dynamically added here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Innovation Leaderboard -->
            <div class="row mb-5">
                <div class="col-lg-8 mx-auto">
                    <div class="card leaderboard-card">
                        <div class="card-header bg-primary text-white">
                            <h3 class="mb-0"><i class="fas fa-trophy me-2"></i>Innovation Leaderboard</h3>
                        </div>
                        <div class="card-body">
                            <div class="leaderboard-list">
                                <!-- Leaderboard entries will be dynamically added here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Achievements -->
            <div class="row g-4 achievements-grid">
                <!-- Achievement cards will be dynamically added here -->
            </div>

            <!-- Nominate Button -->
            <div class="text-center mt-5">
                <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#nominateModal">
                    <i class="fas fa-award me-2"></i>Nominate a Champion
                </button>
            </div>
        </div>
    </section>

    <!-- Nominate Modal -->
    <div class="modal fade" id="nominateModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Nominate an Innovation Champion</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="nominationForm" class="needs-validation" novalidate>
                        <div class="mb-3">
                            <label class="form-label">Nominee</label>
                            <select class="form-select" id="nomineeSelect" required>
                                <option value="">Select a colleague...</option>
                                <!-- Options will be dynamically added -->
                            </select>
                            <div class="invalid-feedback">Please select a nominee.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="categorySelect" required>
                                <option value="">Select category...</option>
                                <option value="technical">Technical Innovation</option>
                                <option value="process">Process Improvement</option>
                                <option value="product">Product Innovation</option>
                                <option value="sustainability">Sustainability Initiative</option>
                                <option value="collaboration">Outstanding Collaboration</option>
                            </select>
                            <div class="invalid-feedback">Please select a category.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Achievement Description</label>
                            <textarea class="form-control" id="achievementDescription" rows="4" required 
                                    placeholder="Describe their innovative achievement..."></textarea>
                            <div class="invalid-feedback">Please describe the achievement.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Impact</label>
                            <textarea class="form-control" id="achievementImpact" rows="3" required 
                                    placeholder="Describe the impact of this innovation..."></textarea>
                            <div class="invalid-feedback">Please describe the impact.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitNomination()">Submit Nomination</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Collaboration Section -->
    <section id="collaborate" class="section">
        <div class="container">
            <h2>Collaborate & Share</h2>
            <div class="collaboration-tools">
                <div class="row">
                    <div class="col-md-6">
                        <div class="idea-submission">
                            <h3>Submit Your Innovation</h3>
                            <form id="innovationForm" onsubmit="collaborativeTools.handleInnovationSubmit(event)">
                                <div class="mb-3">
                                    <label for="innovationTitle" class="form-label">Title *</label>
                                    <input type="text" class="form-control" id="innovationTitle" required>
                                </div>
                                <div class="mb-3">
                                    <label for="innovationDescription" class="form-label">Brief Description *</label>
                                    <textarea class="form-control" id="innovationDescription" rows="2" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="innovationContent" class="form-label">Detailed Content *</label>
                                    <textarea class="form-control" id="innovationContent" rows="4" required 
                                        placeholder="Please provide detailed information about your innovation (minimum 50 characters)"></textarea>
                                    <div class="form-text">Detailed content is required for submission. Minimum 50 characters.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="innovationCategory" class="form-label">Category *</label>
                                    <select class="form-select" id="innovationCategory" required>
                                        <option value="">Select a category</option>
                                        <option value="Process Improvement">Process Improvement</option>
                                        <option value="Technology">Technology</option>
                                        <option value="Education">Education</option>
                                        <option value="Research">Research</option>
                                        <option value="Student Experience">Student Experience</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="innovationImpact" class="form-label">Potential Impact *</label>
                                    <textarea class="form-control" id="innovationImpact" rows="2" required></textarea>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Submit Innovation</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="discussion-forum">
                            <h3>Discussion Forum</h3>
                            <div class="forum-posts" id="forumPosts"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Analytics and Insights Section -->
    <section id="analytics" class="analytics-section">
        <div class="container">
            <div class="metrics-summary">
                <div class="metric-box">
                    <div class="metric-value" id="totalInnovations">0</div>
                    <div class="metric-label">Total Innovations</div>
                    <div class="trend-indicator up">
                        <i class="fas fa-arrow-up"></i>
                        <span>12%</span>
                    </div>
                </div>
                <div class="metric-box">
                    <div class="metric-value" id="activeCollaborations">0</div>
                    <div class="metric-label">Active Collaborations</div>
                    <div class="trend-indicator up">
                        <i class="fas fa-arrow-up"></i>
                        <span>8%</span>
                    </div>
                </div>
                <div class="metric-box">
                    <div class="metric-value" id="departmentEngagement">0%</div>
                    <div class="metric-label">Department Engagement</div>
                    <div class="trend-indicator down">
                        <i class="fas fa-arrow-down"></i>
                        <span>3%</span>
                    </div>
                </div>
                <div class="metric-box">
                    <div class="metric-value" id="implementationRate">0%</div>
                    <div class="metric-label">Implementation Rate</div>
                    <div class="trend-indicator up">
                        <i class="fas fa-arrow-up"></i>
                        <span>5%</span>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="analytics-card">
                        <div class="analytics-header">
                            <h5 class="analytics-title">Innovation Trends</h5>
                        </div>
                        <div class="chart-container">
                            <canvas id="innovationTrendsChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="analytics-card">
                        <div class="analytics-header">
                            <h5 class="analytics-title">Department Performance</h5>
                        </div>
                        <div class="chart-container">
                            <canvas id="departmentPerformanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="analytics-card">
                        <div class="analytics-header">
                            <h5 class="analytics-title">Impact Analysis</h5>
                        </div>
                        <div class="chart-container">
                            <canvas id="impactAnalysisChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="analytics-card">
                        <div class="analytics-header">
                            <h5 class="analytics-title">Collaboration Network</h5>
                        </div>
                        <div class="chart-container">
                            <canvas id="collaborationNetworkChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="analytics-insights mt-4">
                <!-- Insights will be dynamically populated here -->
            </div>
        </div>
    </section>

    <!-- Innovation Leaderboard Section -->
    <section id="leaderboard" class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-4">Innovation Leaderboard</h2>
            <div class="row">
                <!-- Top Innovators -->
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <h3 class="card-title mb-0"><i class="fas fa-trophy me-2"></i>Top Innovators</h3>
                        </div>
                        <div class="card-body">
                            <div id="top-innovators" class="list-group">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Achievements -->
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-header bg-success text-white">
                            <h3 class="card-title mb-0"><i class="fas fa-star me-2"></i>Recent Achievements</h3>
                        </div>
                        <div class="card-body">
                            <div id="recent-achievements" class="list-group">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Innovation Statistics -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-info text-white">
                            <h3 class="card-title mb-0"><i class="fas fa-chart-bar me-2"></i>Innovation Statistics</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="stats-box text-center p-3 border rounded">
                                        <i class="fas fa-lightbulb fa-2x text-warning mb-2"></i>
                                        <h4 id="total-innovations">0</h4>
                                        <p class="mb-0">Total Innovations</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="stats-box text-center p-3 border rounded">
                                        <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                                        <h4 id="completed-innovations">0</h4>
                                        <p class="mb-0">Completed Projects</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="stats-box text-center p-3 border rounded">
                                        <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                        <h4 id="active-innovators">0</h4>
                                        <p class="mb-0">Active Innovators</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <canvas id="innovation-trends"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly Highlights -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-warning text-dark">
                            <h3 class="card-title mb-0"><i class="fas fa-calendar-alt me-2"></i>Monthly Highlights</h3>
                        </div>
                        <div class="card-body">
                            <div id="monthly-highlights" class="row">
                                <!-- Dynamically populated -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Champion Nominations Section -->
    <section id="nominations" class="py-5">
        <div class="container">
            <h2 class="text-center mb-4">Champion Nominations</h2>
            
            <!-- Nominate Button -->
            <div class="text-center mb-4">
                <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#nominateModal">
                    <i class="fas fa-trophy me-2"></i>Nominate a Champion
                </button>
            </div>

            <!-- Nomination Categories -->
            <div class="row mb-4" id="nomination-categories">
                <!-- Dynamically populated -->
            </div>

            <!-- Current Nominations -->
            <div class="row" id="current-nominations">
                <!-- Dynamically populated -->
            </div>
        </div>
    </section>

    <!-- Nominate Modal -->
    <div class="modal fade" id="nominateModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Nominate a Champion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="nominationForm">
                        <div class="mb-3">
                            <label class="form-label">Category</label>
                            <select class="form-select" name="category" required>
                                <!-- Dynamically populated -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nominee</label>
                            <select class="form-select" name="nominee_id" required>
                                <!-- Dynamically populated -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Why are you nominating this person?</label>
                            <textarea class="form-control" name="reason" rows="3" required 
                                placeholder="Describe why this person deserves recognition..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitNomination">Submit Nomination</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p>&copy; 2024 Innovation Tracking Portal</p>
                </div>
                <div class="col-md-6 text-end">
                    <div class="social-links">
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                        <a href="#"><i class="fab fa-github"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="node_modules/chart.js/dist/chart.umd.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script>
        // Fetch and display leaderboard data
        async function fetchLeaderboardData() {
            try {
                const response = await fetch('/api/leaderboard');
                const data = await response.json();
                updateLeaderboard(data);
            } catch (error) {
                console.error('Error fetching leaderboard data:', error);
            }
        }

        // Update leaderboard UI
        function updateLeaderboard(data) {
            // Update Top Innovators
            const topInnovatorsHtml = data.topInnovators.map((innovator, index) => `
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <span class="badge bg-primary me-2">#${index + 1}</span>
                        <span>${innovator.name}</span>
                    </div>
                    <span class="badge bg-secondary">${innovator.innovations} innovations</span>
                </div>
            `).join('');
            document.getElementById('top-innovators').innerHTML = topInnovatorsHtml;

            // Update Recent Achievements
            const achievementsHtml = data.recentAchievements.map(achievement => `
                <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">${achievement.title}</h6>
                        <small>${achievement.date}</small>
                    </div>
                    <p class="mb-1">${achievement.description}</p>
                    <small class="text-muted">By ${achievement.user}</small>
                </div>
            `).join('');
            document.getElementById('recent-achievements').innerHTML = achievementsHtml;

            // Update Statistics
            document.getElementById('total-innovations').textContent = data.stats.total;
            document.getElementById('completed-innovations').textContent = data.stats.completed;
            document.getElementById('active-innovators').textContent = data.stats.activeInnovators;

            // Update Innovation Trends Chart
            const ctx = document.getElementById('innovation-trends').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.trends.labels,
                    datasets: [{
                        label: 'New Innovations',
                        data: data.trends.values,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Innovation Trends'
                        }
                    }
                }
            });

            // Update Monthly Highlights
            const highlightsHtml = data.monthlyHighlights.map(highlight => `
                <div class="col-md-4 mb-3">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">${highlight.title}</h5>
                            <p class="card-text">${highlight.description}</p>
                            <div class="text-muted">
                                <small><i class="fas fa-user me-1"></i>${highlight.team}</small>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('monthly-highlights').innerHTML = highlightsHtml;
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            fetchLeaderboardData();
            // Refresh data every 5 minutes
            setInterval(fetchLeaderboardData, 300000);
        });
    </script>

    <script>
        // Nomination System
        async function loadNominations() {
            try {
                const [categoriesResponse, nominationsResponse, usersResponse] = await Promise.all([
                    fetch('/api/nominations/categories'),
                    fetch('/api/nominations'),
                    fetch('/api/users')
                ]);

                const categories = await categoriesResponse.json();
                const nominations = await nominationsResponse.json();
                const users = await usersResponse.json();

                // Populate categories
                const categoriesHtml = categories.map(category => `
                    <div class="col-md-4 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">${category.name}</h5>
                                <p class="card-text">${category.description}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
                document.getElementById('nomination-categories').innerHTML = categoriesHtml;

                // Populate nomination form
                const categorySelect = document.querySelector('#nominationForm select[name="category"]');
                categorySelect.innerHTML = categories.map(category => 
                    `<option value="${category.id}">${category.name}</option>`
                ).join('');

                const nomineeSelect = document.querySelector('#nominationForm select[name="nominee_id"]');
                nomineeSelect.innerHTML = users.map(user => 
                    `<option value="${user.id}">${user.username}</option>`
                ).join('');

                // Display current nominations
                const nominationsHtml = nominations.map(nomination => `
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <h5 class="card-title">${nomination.nominee_name}</h5>
                                    <span class="badge bg-primary">${nomination.category}</span>
                                </div>
                                <p class="card-text">${nomination.reason}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">Nominated by ${nomination.nominator_name}</small>
                                    <button class="btn btn-outline-primary vote-btn ${nomination.hasVoted ? 'voted' : ''}"
                                            data-nomination-id="${nomination.id}">
                                        <i class="fas fa-thumbs-up me-1"></i>
                                        <span class="vote-count">${nomination.votes}</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                document.getElementById('current-nominations').innerHTML = nominationsHtml;

                // Add vote button handlers
                document.querySelectorAll('.vote-btn').forEach(button => {
                    button.addEventListener('click', handleVote);
                });

            } catch (error) {
                console.error('Error loading nominations:', error);
            }
        }

        async function handleVote(event) {
            const button = event.currentTarget;
            const nominationId = button.dataset.nominationId;
            
            try {
                const response = await fetch(`/api/nominations/${nominationId}/vote`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.voted) {
                    button.classList.add('voted');
                    button.querySelector('.vote-count').textContent = 
                        parseInt(button.querySelector('.vote-count').textContent) + 1;
                } else {
                    button.classList.remove('voted');
                    button.querySelector('.vote-count').textContent = 
                        parseInt(button.querySelector('.vote-count').textContent) - 1;
                }
            } catch (error) {
                console.error('Error processing vote:', error);
            }
        }

        // Handle nomination submission
        document.getElementById('submitNomination').addEventListener('click', async () => {
            const form = document.getElementById('nominationForm');
            const formData = new FormData(form);
            
            try {
                const response = await fetch('/api/nominations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(Object.fromEntries(formData))
                });
                
                if (response.ok) {
                    // Close modal and refresh nominations
                    bootstrap.Modal.getInstance(document.getElementById('nominateModal')).hide();
                    form.reset();
                    loadNominations();
                    showAlert('Nomination submitted successfully!', 'success');
                } else {
                    const error = await response.json();
                    showAlert(error.message || 'Failed to submit nomination', 'danger');
                }
            } catch (error) {
                console.error('Error submitting nomination:', error);
                showAlert('Failed to submit nomination', 'danger');
            }
        });

        // Load nominations on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadNominations();
        });
    </script>

    <script>
        // Load achievements
        async function loadAchievements(userId) {
            try {
                const response = await fetch(`/api/nominations/achievements/${userId}`);
                const data = await response.json();

                const { achievements, progress } = data;

                // Update progress bar
                const progressPercent = (progress.earned / progress.total) * 100;
                document.querySelector('.progress-bar').style.width = `${progressPercent}%`;
                document.getElementById('earned-badges').textContent = progress.earned;
                document.getElementById('total-badges').textContent = progress.total;

                // Display achievements
                const achievementsHtml = Object.entries(progress.criteria).map(([type, criteria]) => {
                    const earned = achievements.find(a => a.badge_type === type);
                    const badgeClass = earned ? 'earned' : 'locked';
                    const earnedDate = earned ? new Date(earned.earned_date).toLocaleDateString() : '';

                    return `
                        <div class="col-md-6 mb-4">
                            <div class="achievement-card ${badgeClass}">
                                <div class="achievement-icon">
                                    ${getBadgeIcon(type)}
                                </div>
                                <div class="achievement-info">
                                    <h6>${formatBadgeName(type)}</h6>
                                    <p>${criteria.description}</p>
                                    ${earned ? `<small class="text-success">Earned on ${earnedDate}</small>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                document.getElementById('achievements-list').innerHTML = achievementsHtml;

            } catch (error) {
                console.error('Error loading achievements:', error);
            }
        }

        // Helper functions
        function getBadgeIcon(type) {
            const icons = {
                innovation_master: 'ðŸŽ¯',
                collaboration_expert: 'ðŸ¤',
                rising_star: 'â­',
                impact_leader: 'ðŸ’«',
                problem_solver: 'ðŸ”§'
            };
            return icons[type] || 'ðŸ†';
        }

        function formatBadgeName(type) {
            return type.split('_')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        // Settings
        document.getElementById('saveSettings').addEventListener('click', async () => {
            const emailNotifications = document.getElementById('emailNotifications').checked;

            try {
                const response = await fetch('/api/nominations/settings', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email_notifications: emailNotifications })
                });

                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
                    showAlert('Settings saved successfully!', 'success');
                } else {
                    showAlert('Failed to save settings', 'danger');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                showAlert('Failed to save settings', 'danger');
            }
        });

        // Load achievements when modal opens
        document.getElementById('achievementsModal').addEventListener('show.bs.modal', () => {
            loadAchievements(currentUser.id);
        });
    </script>
</body>
</html>
